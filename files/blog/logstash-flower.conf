input {
  beats {
    port => 5044
  }
}

filter {
	if([type] == "flower") {
		grok {
			match =>  { 
				"message" => "(?m)%{TIMESTAMP_ISO8601:timestamp} (?<threadName>(\[.*\])) %{LOGLEVEL:logLevel} ?%{SPACE} %{JAVACLASS:class} - %{GREEDYDATA:Content}"
			}
		}
	}
	else if([type] == "tomcat"){
		grok {
			match =>  { 
				"message" => "(?m)(?<timestamp>(%{MONTHDAY}-%{MONTH}-%{YEAR}\s%{TIME})) (?<logLevel>(.*)) (?<threadName>(\[.*\])) %{JAVACLASS:class} %{GREEDYDATA:Content}" 
			}
		}
	}
	date {
		match => ["timestamp", "dd/MMM/yyyy:HH:mm:ss Z", "YYYY-MM-dd HH:mm:ss,SSS", "dd-MMM-yyyy HH:mm:ss.SSS"]
	}
	mutate {
		remove_field => [ "timestamp" ]
	}
}

output {
  elasticsearch {
    hosts => "localhost:9200"
    index => "flower-%{[@metadata][beat]}"
    document_type => "%{[@metadata][type]}"
  }
}