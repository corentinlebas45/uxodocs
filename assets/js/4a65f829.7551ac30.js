"use strict";(globalThis.webpackChunkuxodocs=globalThis.webpackChunkuxodocs||[]).push([[4600],{1801:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"advanced/javascript","title":"javascript","description":"Using the JSTransform task can comes in quite handy for any tweaking of metadata, but will also get you covered in case of heavier operations, as long as your JavaScript talents match you problem solving skills !","source":"@site/docs/fast2/advanced/javascript.md","sourceDirName":"advanced","slug":"/advanced/javascript","permalink":"/uxodocs/docs/fast2/advanced/javascript","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Drools: the Java rules engine","permalink":"/uxodocs/docs/fast2/advanced/drools"},"next":{"title":"TODO","permalink":"/uxodocs/docs/fast2/advanced/optimization"}}');var o=n(4848),s=n(8453);const c={},r=void 0,i={},l=[{value:"Example #1 <small>Map document properties from JSON</small>",id:'map-from-json data-toc-label="#1: Map from JSON"',level:2},{value:"Example #2 <small>Delete content based on property</small>",id:'delete-content data-toc-label="#2: Delete specific content"',level:2},{value:"Example #3 <small>Get content path</small>",id:'get-content-path data-toc-label="#3: Get content path in JS"',level:2},{value:"Bonus tip",id:"bonus-tip",level:2},{value:"In the end, it&#39;s all just about you",id:"in-the-end-its-all-just-about-you",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Using the ",(0,o.jsx)(t.a,{href:"/uxodocs/docs/fast2/catalog/transformer#JSTransform",children:"JSTransform"})," task can comes in quite handy for any tweaking of metadata, but will also get you covered in case of heavier operations, as long as your JavaScript talents match you problem solving skills !\nTo iterate through all documents crossing your JS task, here is a short code snippet to help you get started:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"punnet.getDocuments().forEach(function (doc) {\n  // do something\n});\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Any data within a punnet can be accessed, added, edited or remove ! Make sure beforehand to respect the punnet object architecture (",(0,o.jsx)(t.a,{href:"/uxodocs/docs/fast2/getting-started/overall-concepts#punnet",children:"quick reminder here"})," if need be \ud83d\ude09)."]}),"\n",(0,o.jsx)(t.p,{children:"Let's now go through 3 quick scenarios."}),"\n",(0,o.jsxs)(t.h2,{id:'map-from-json data-toc-label="#1: Map from JSON"',children:["Example #1 ",(0,o.jsx)("small",{children:"Map document properties from JSON"})]}),"\n",(0,o.jsx)(t.p,{children:"Depending on your use-case, the metadata could have been stored within a JSON file. Parsing such file and build a punnet based on its content is another kind of operation where this Fast2 task comes in handy !"}),"\n",(0,o.jsx)(t.p,{children:"The following script is one way to parse a basic JSON metadata file."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'// First, get content as String\nvar content = punnet\n  .getDocumentList()\n  .get(0)\n  .getContentSet()\n  .getContent()\n  .get(0);\nvar bytes = manager.getPunnetContentFactory().getContentAsByteArray(content);\n\nvar String = Java.type("java.lang.String");\nvar lines = new String(bytes);\n\n// Then, parse this fragment as JSON\nvar jsonObject = JSON.parse(lines);\n\n// Clear existing document and create a new one\npunnet.getDocumentList().clear();\nvar doc = punnet.addDocument(com.fast2.model.punnet.DocumentId.id());\n\n// Fetch all properties from existing fragment and create them as Document data\nfor (pty in jsonObject)\n  doc.getDataSet().addData(pty, "String", jsonObject[pty]);\n'})}),"\n",(0,o.jsx)(t.p,{children:"Once this script is executed, you'll end up with a punnet whose first and only document will have its dataset full of metadata matching both keys and values from the JSON file."}),"\n",(0,o.jsx)(t.p,{children:"Considering the following input embedded in a JSON file:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "name": "testName",\n  "contentPath": "C:/path/to/sample.pdf",\n  "key": "value"\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"the ouput punnet would then look like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "documents": [\n    {\n      "data": {\n        "contentPath": "C:/path/to/sample.pdf",\n        "key": "value",\n        "name": "testName"\n      },\n      "documentId": "ffde4769-3acd-4964-ab72-5912f1e65e1e"\n    }\n  ],\n  "punnetId": "punnet.json#1"\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Next step could be to attach the document content to your document, now that you have the ",(0,o.jsx)(t.code,{children:"contentPath"})," data with its value easily resolved by the ",(0,o.jsx)(t.a,{href:"/uxodocs/docs/fast2/catalog/transformer#AlterDocumentContent",children:"AlterDocumentContent"})," task."]}),"\n",(0,o.jsxs)(t.h2,{id:'delete-content data-toc-label="#2: Delete specific content"',children:["Example #2 ",(0,o.jsx)("small",{children:"Delete content based on property"})]}),"\n",(0,o.jsxs)(t.p,{children:["Let us now supposed we want to filter out document contents based on a given property. For convenience, the reference value is stored at the punnet level, under the property ",(0,o.jsx)(t.code,{children:"punnetKeyA"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["The filter criterion is the following: if the content has the value of its data ",(0,o.jsx)(t.code,{children:"contentKeyA"})," matching the punnet value, the content is left in place. Otherwise, the content is deleted."]}),"\n",(0,o.jsx)(t.p,{children:"Before the punnet enters the JSTransform task, its structure looks like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<ns:punnet xmlns:ns="http://www.arondor.com/xml/document" punnetId="doc_0_0#1">\n\t<ns:documentset>\n\t\t<ns:document documentId="doc_0_0">\n\t\t\t<ns:contentset>\n\t\t\t\t<ns:content>\n\t\t\t\t\t<ns:property name="contentKeyA" value="valueA" />\n\t\t\t\t\t<ns:url>path/of/first/content</ns:url>\n\t\t\t\t</ns:content>\n\t\t\t\t<ns:content>\n\t\t\t\t\t<ns:url>path/of/second/content</ns:url>\n\t\t\t\t</ns:content>\n\t\t\t</ns:contentset>\n\t\t\t<ns:dataset />\n\t\t\t<ns:folderset />\n\t\t\t<ns:annotationset />\n\t\t</ns:document>\n\t</ns:documentset>\n\t<ns:dataset>\n\t\t<ns:data name="punnetKeyA" type="String">\n\t\t\t<ns:value>valueA</ns:value>\n\t\t</ns:data>\n\t</ns:dataset>\n\t<folderSet />\n</ns:punnet>\n'})}),"\n",(0,o.jsx)(t.p,{children:"The first content should then remain as is, while the second one is expected to be removed by the script of our task."}),"\n",(0,o.jsx)(t.p,{children:"Speaking of it, the strategy will be to iterate through all the documents of the punnet; and for each document, iterate through all its contents. Finally, a simple condition will evaluate whether the content is to be kept."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'punnet.getDocuments().forEach(function (document) {\n  var duplicate = [].concat(document.getContentSet());\n\n  duplicate.forEach(function (content) {\n    if (\n      content.getProperty("contentKey") !=\n      punnet.getDataSet().getDataValue("punnetKey")\n    )\n      document.getContentSet().remove(content);\n  });\n});\n'})}),"\n",(0,o.jsx)(t.p,{children:"Once the task is completed (in other terms, once the script has been executed), the output punnet new structure is lightened:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<ns:punnet xmlns:ns="http://www.arondor.com/xml/document" punnetId="doc_0_0#1">\n\t<ns:documentset>\n\t\t<ns:document documentId="doc_0_0">\n\t\t\t<ns:contentset>\n\t\t\t\t<ns:content>\n\t\t\t\t\t<ns:property name="contentKeyA" value="valueA" />\n\t\t\t\t\t<ns:url>path/of/first/content</ns:url>\n\t\t\t\t</ns:content>\n\t\t\t</ns:contentset>\n\t\t\t<ns:dataset />\n\t\t\t<ns:folderset />\n\t\t\t<ns:annotationset />\n\t\t</ns:document>\n\t</ns:documentset>\n\t<ns:dataset>\n\t\t<ns:data name="punnetKeyA" type="String">\n\t\t\t<ns:value>valueA</ns:value>\n\t\t</ns:data>\n\t</ns:dataset>\n\t<folderSet />\n</ns:punnet>\n'})}),"\n",(0,o.jsx)(t.p,{children:"As expected, the second content is gone.\nIf the content to filter out was inside a parent content of this document (i.e. punnet > document > first level content > second level content), this JS code should have been adapted to add one deeper level of content scanning:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'punnet.getDocuments().forEach(function (document) {\n  document.getContentSet().forEach(function (firstLevelContent) {\n    var duplicate = [].concat(firstLevelContent.getSubContents());\n    duplicate.forEach(function (secondLevelContent) {\n      if (\n        secondLevelContent.getProperty("contentKeyA") !=\n        punnet.getDataSet().getDataValue("punnetKeyA")\n      )\n        firstLevelContent.getSubContents().remove(secondLevelContent);\n    });\n  });\n});\n'})}),"\n",(0,o.jsxs)(t.h2,{id:'get-content-path data-toc-label="#3: Get content path in JS"',children:["Example #3 ",(0,o.jsx)("small",{children:"Get content path"})]}),"\n",(0,o.jsx)(t.p,{children:"Another application of this task could be to reach values outside the scope of the document dataset, like for example the path of the associated content."}),"\n",(0,o.jsx)(t.p,{children:"This value is stored tightly within the content, which is why passing via the manager component of the JSTransform task is required."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'punnet.getDocuments().forEach(function (doc) {\n    var path = manager.getPunnetContentFactory().getContentAsFile(doc.getContentSet().get(0)).getPath();\n    doc.getDataSet().addData("pathCopy", "String", path);\n});\n'})}),"\n",(0,o.jsxs)(t.p,{children:["The temporary variable ",(0,o.jsx)(t.code,{children:"path"}),", which the value of the absolute path will be stored into, can thereafter be accessed as a regular metadata under the key ",(0,o.jsx)(t.code,{children:"pathCopy"})," alongside the other document metadata."]}),"\n",(0,o.jsx)(t.p,{children:"We can envision further operations of this value (or any other from the dataset), such as truncating, hashing, comparison etc."}),"\n",(0,o.jsx)(t.h2,{id:"bonus-tip",children:"Bonus tip"}),"\n",(0,o.jsx)(t.p,{children:"When a Java class needs to be manipulated within the JavaScript code, a variable analogous to a Java class needs to be created:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'var Id = Java.type("com.example.package.Id");\n\npunnet.getDocuments().forEach(function (doc) {\n  var id = Id.id("myStringId");\n\n  ...\n});\n'})}),"\n",(0,o.jsx)(t.h2,{id:"in-the-end-its-all-just-about-you",children:"In the end, it's all just about you"}),"\n",(0,o.jsx)(t.p,{children:"As you can imagine, several other use-cases can be addressed by implementing on-the-fly JS scripts, just like the ones showed above. The capabilities of this task are endless: team with Fast2 on this fight floor, and tackle your migration with your sharpened coding skills !"})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>r});var a=n(6540);const o={},s=a.createContext(o);function c(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);