"use strict";(globalThis.webpackChunkuxodocs=globalThis.webpackChunkuxodocs||[]).push([[44],{5033:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"advanced/patterns","title":"Patterns","description":"A pattern is a sequence of instructions, a model, which can be easily recognized by an aware glance. It is strictly under this definition that Fast2 patterns stand.","source":"@site/docs/fast2/advanced/patterns.md","sourceDirName":"advanced","slug":"/advanced/patterns","permalink":"/uxodocs/docs/fast2/advanced/patterns","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"configuration","permalink":"/uxodocs/docs/fast2/tags/configuration"},{"inline":true,"label":"Java","permalink":"/uxodocs/docs/fast2/tags/java"}],"version":"current","frontMatter":{"draft":false,"title":"Patterns","tags":["configuration","Java"]},"sidebar":"docs","previous":{"title":"TODO","permalink":"/uxodocs/docs/fast2/advanced/optimization"},"next":{"title":"Schedule your campaigns","permalink":"/uxodocs/docs/fast2/advanced/scheduler"}}');var a=n(4848),i=n(8453);const o={draft:!1,title:"Patterns",tags:["configuration","Java"]},r=void 0,d={},c=[{value:"Patterns, what are they anyway ?",id:'context-and-definition data-toc-label="Context and definition" ',level:2},{value:"Patterns in links",id:"patterns-in-links",level:2},{value:"As long as it returns <code>true</code> of <code>false</code>...",id:"as-long-as-it-returns-true-of-false",level:3},{value:"Patterns subtleties",id:"patterns-subtleties",level:2},{value:"Properties with colon",id:"properties-with-colon",level:3},{value:"Propose default value",id:"propose-default-value",level:3},{value:"Access data of Fast2 objects",id:"access-data-of-fast2-objects",level:3},{value:"Using Java classes",id:"using-java-classes",level:3}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"A pattern is a sequence of instructions, a model, which can be easily recognized by an aware glance. It is strictly under this definition that Fast2 patterns stand."}),"\n",(0,a.jsx)(t.p,{children:"Our migration tool relies on a specific syntax used to dynamically retrieve information from different data-layer of the whole process, whether document, map execution or else."}),"\n",(0,a.jsxs)(t.admonition,{type:"tip",children:[(0,a.jsx)(t.p,{children:"For a successful pattern recognition, only use the data known by Fast2, such as :"}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Data stored in the punnet and/or documents datasets"}),"\n",(0,a.jsxs)(t.li,{children:["Migration specific details, listed ",(0,a.jsx)(t.a,{href:"#access-data-of-fast2-objects",children:"down below"}),"."]}),"\n"]})]}),"\n",(0,a.jsx)(t.h2,{id:'context-and-definition data-toc-label="Context and definition" ',children:"Patterns, what are they anyway ?"}),"\n",(0,a.jsxs)(t.p,{children:["In Fast2, several data can be retrieved and accessed dynamically from a dedicated syntax which Fast2 supports for your convenience. This ",(0,a.jsx)(t.code,{children:"${...}"})," syntax can be used in most of the configuration fields of the tasks composing your migration workflow."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Example of pattern implementation",src:n(6830).A+"",width:"335",height:"393"})}),"\n",(0,a.jsxs)(t.p,{children:["Using such syntax will comes in handy when you will have to rely on a value whose you only know the name. In other words, retrieving a metadata whose key is ",(0,a.jsx)(t.code,{children:"doc_mimeType"})," and value is unique for every document, will just be ",(0,a.jsx)(t.code,{children:"${doc_mimeType}"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"No need to list all your possible values, Fast2 will resolve this expression by looking first at the document dataset level, then at the punnet level, an later at map/campaign level. Some applications of the latter could be to store the name of the map, or even accessing map- or global-scoped shared objects for cross-campaign communications."}),"\n",(0,a.jsx)(t.h2,{id:"patterns-in-links",children:"Patterns in links"}),"\n",(0,a.jsx)(t.p,{children:"Although links are designed to offer basic statements for conditional routing, they also digest pattern for higher-complexity conditions. For example, new conditions can be value-dependent: not only you can check whether the document has a given data, but now it is possible to narrow down the eligible documents based on the value itself of this data."}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:["Pattern-related syntax ",(0,a.jsx)(t.code,{children:"${...}"})," is not required, fill the field with your expression directly !"]})}),"\n",(0,a.jsxs)(t.p,{children:["Based on SpEL (",(0,a.jsx)(t.a,{href:"https://docs.spring.io/spring-framework/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html",children:"Spring Expression Language"}),"), the syntax of these conditions will sound familiar to anyone who's already coded one day:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Example of pattern implementation as link condition",src:n(5311).A+"",width:"394",height:"323"})}),"\n",(0,a.jsx)(t.p,{children:"In the same way, you'll now be able to sort documents based on their mime-types, on their structure (does my document has a content ? Is its creation date matching the time range which this campaign is focusing on? )."}),"\n",(0,a.jsx)(t.p,{children:"As mentioned earlier, the list of data which you can evaluate in a condition is the same list as in a task configuration (document properties, punnet properties, map and campaign names)."}),"\n",(0,a.jsxs)(t.h3,{id:"as-long-as-it-returns-true-of-false",children:["As long as it returns ",(0,a.jsx)(t.code,{children:"true"})," of ",(0,a.jsx)(t.code,{children:"false"}),"..."]}),"\n",(0,a.jsx)(t.p,{children:"More complex use-cases can be built out of the given tools, as long as the syntax matches the SpEL expression. Java-based condition are therefore supported, here are some examples to help you getting started :"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.code,{children:'documentId.endsWith("0")'})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.code,{children:'mimeType.startsWith("image/")'})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.code,{children:'documents.size() >= 2 || punnet.getDataSet().hasData("multiversioned")'})}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"And the list goes on, it's your turn now to build the condition meeting your needs!"}),"\n",(0,a.jsx)(t.h2,{id:"patterns-subtleties",children:"Patterns subtleties"}),"\n",(0,a.jsx)(t.h3,{id:"properties-with-colon",children:"Properties with colon"}),"\n",(0,a.jsx)(t.p,{children:"As handy as they may sound, patterns do embed specifications due to the particular syntax they are subjected to."}),"\n",(0,a.jsxs)(t.p,{children:["The most common issue is when dealing with colon character ",(0,a.jsx)(t.code,{children:":"}),", but the approach also addressed data name with space characters. To prevent running into a SpEL syntax error which would wipe its interest out, the syntax has to be slightly expanded. Where before you were accessing the value with ",(0,a.jsx)(t.code,{children:"${key}"}),", you now need to write it as follows:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"${property('prefix:suffix')}\n\n${property('with space')}\n"})}),"\n",(0,a.jsx)(t.p,{children:"You can now safely extract data with namespaces, or any special character which may eventually break the SpEL syntax."}),"\n",(0,a.jsx)(t.h3,{id:"propose-default-value",children:"Propose default value"}),"\n",(0,a.jsx)(t.p,{children:"In case the pattern value is not known by Fast2, an empty String is return. However, you might be willing to set a default value to ease the upcoming operations."}),"\n",(0,a.jsxs)(t.p,{children:["To do so, use the Elvis ternary operator along the ",(0,a.jsx)(t.code,{children:"property()"})," function:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"${property('missingData')?:'defaultValue'}\n"})}),"\n",(0,a.jsx)(t.p,{children:"From now on, if the 'missingData' is not fount either at the punnet or document level, the value you earlier planned to retrieve will be replaced with the value set as default, although no additional property is created."}),"\n",(0,a.jsx)(t.h3,{id:"access-data-of-fast2-objects",children:"Access data of Fast2 objects"}),"\n",(0,a.jsxs)(t.p,{children:["Whether you need ",(0,a.jsx)(t.a,{href:"/uxodocs/docs/fast2/getting-started/overall-concepts#fast2-objects",children:"subtypes"})," properties for conditional routing or metadata elaboration, Fast2 gives you access to any data stored in the punnet."]}),"\n",(0,a.jsxs)(t.p,{children:["However targetting object is not always intuitive, so here are the different keywords required to access the ",(0,a.jsx)(t.a,{href:"/uxodocs/docs/fast2/getting-started/overall-concepts#fast2-objects",children:"Fast2 objects"})," :"]}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Keyword"}),(0,a.jsx)(t.th,{children:"Description"}),(0,a.jsx)(t.th,{children:"Examples"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${CurrentDocument}"})}),(0,a.jsxs)(t.td,{children:["Access the focused document, to call its metadata. ",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"This can be quite useful when dealing with multi-document punnets."]}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${CurrentDocument.getDataSet().getData('multivalued data').getValues().get(0).split('\\.')[0]}"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${CurrentContainer}"})}),(0,a.jsxs)(t.td,{children:["Access the focused content, to call its properties. ",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"This can be quite useful when dealing with multi-contented documents."]}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${CurrentContainer.mimetype}"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${CurrentAnnotation}"})}),(0,a.jsx)(t.td,{children:"Access the annotation of the document."}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${CurrentAnnotation.annotationId}"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${punnet}"})}),(0,a.jsxs)(t.td,{children:["Access the punnet as an object. ",(0,a.jsx)("br",{}),"From there, all datasets and subobjects can be accessed.",(0,a.jsx)("br",{}),"The accessor is generally used for conditions."]}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${punnetId.toString().startsWith('My')}"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${documents}"})}),(0,a.jsx)(t.td,{children:"The list of the documents stored in the punnet."}),(0,a.jsxs)(t.td,{children:[(0,a.jsx)(t.code,{children:"${documents.size()}"})," ",(0,a.jsx)(t.code,{children:"${documents.get(0)}"})]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${step}"})}),(0,a.jsx)(t.td,{children:"The name of the step where the pattern is called."}),(0,a.jsx)(t.td,{})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${map}"})}),(0,a.jsxs)(t.td,{children:["The name of the map which is run during this campaign. ",(0,a.jsx)("br",{}),"Often used for output directory names"]}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${map}/my_output_file.csv"})})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${campaign}"})}),(0,a.jsx)(t.td,{children:"The name of the campaign. Often used for output directory names"}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"${map}/${campaign}/my_output_file.csv"})})]})]})]}),"\n",(0,a.jsx)(t.h3,{id:"using-java-classes",children:"Using Java classes"}),"\n",(0,a.jsx)(t.p,{children:"Pattern can also be used to enrich data, relying on the basic Java classes."}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsxs)(t.p,{children:["The required syntax is ",(0,a.jsx)(t.code,{children:"T(clazz)"}),"."]})}),"\n",(0,a.jsx)(t.p,{children:"For example, adding an UUID created on-the-fly would just required using the following pattern:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:"${T(java.util.UUID).randomUUID().toString()}\n"})}),"\n",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(t.p,{children:"An other example could be to add today's date as a new data. Such a pattern might go like:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:"${T(java.time.LocalDate).now().toString()}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Bringing it further, we might also want the time when the document got through the migration (namely this ",(0,a.jsx)(t.a,{href:"/uxodocs/docs/fast2/catalog/transformer#AlterDocumentProperties",children:"AlterDocumentProperties"})," task), with"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:"${T(java.time.LocalDateTime).now().toString()}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Mapping these patterns respectively to a new ",(0,a.jsx)(t.code,{children:"today"})," and ",(0,a.jsx)(t.code,{children:"currentTime"})," data will result in the following punnet :"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",metastring:"{11-12}",children:'{\n\t"punnetId": "doc_0_0#1",\n\t"data": {\n        ...\n\t},\n\t"documents": [\n\t\t{\n\t\t\t"documentId": "doc_0_0",\n\t\t\t"data": {\n\t\t\t\t...\n\t\t\t\t"currentTime": "2023-06-14T10:42:15.204958800",\n\t\t\t\t"today": "2023-06-14"\n\t\t\t}\n\t\t}\n\t]\n}\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},5311:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/pattern_condition2025-704d09b99b5d5c344c7bd82f2ff9a535.png"},6830:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/pattern_example2025-d3f2586e359dadd9193a6a0b10788a08.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var s=n(6540);const a={},i=s.createContext(a);function o(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);