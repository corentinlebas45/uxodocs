+++
date = "2019-03-29T13:20:01+02:00"
title = "Métriques"
description = "Mesurez votre stack FlowerDocs"
+++

# Métriques 

La plateforme FlowerDocs expose diverses métriques permettant d'obtenir des retours quantitatifs sur l'utilisation de FlowerDocs Core. Ces métriques concernent différents aspects, de la consommation des services à l'usage de la JVM.


Les métriques sont, pour la plupart, exposées avec des tags permettant de disposer de métriques contextualisées, plus précises.

## Métriques applicatives

### Composants

Les métriques concernant les composants sont listées dans les tableaux ci-dessous. Elles sont exposées avec des tags permettant de les filtrer en fonction : 

* du scope concerné (`scope`)
* de l'exception déclenchée (`exception`)

|Nom | Description |
|----------|-------------|
|`createDocuments`|Créations de documents|
|`getDocuments`|Récupérations de documents|
|`searchDocuments`|Recherches de documents|
|`updateDocuments`|Mises à jour de documents|
|`deleteDocuments`|Suppressions de documents|
|`addFilesDocuments`|Ajouts de contenus à des documents|
|`getFileDocuments`|Récupérations de contenus de documents|
|`getFilesDocuments`|Récupérations des contenus de documents|
|`promoteVersion`|Créations d'une version de documents|
|`getVersionsVersion`|Récupérations des versions de documents|
|`revertVersion`|Restaurations de versions de documents|
|Nom | Description |
|----------|-------------|
|`createFolders`|Créations de dossiers|
|`getFolders`|Récupérations de dossiers|
|`searchFolders`|Recherches de dossiers|
|`updateFolders`|Mises à jour de dossiers|
|`deleteFolders`|Suppressions de dossiers|
|`addChildrenFolders`|Ajouts de composants dans des dossiers|
|`deleteChildrenFolders`|Suppressions de composants de dossiers|
|Nom | Description |
|----------|-------------|
|`createVirtualFolders`|Créations de dossiers virtuels|
|`getVirtualFolders`|Récupérations de dossiers virtuels|
|`searchVirtualFolders`|Recherches de dossiers virtuels|
|`updateVirtualFolders`|Mises à jour de dossiers virtuels|
|`deleteVirtualFolders`|Suppressions de dossiers virtuels|
|Nom | Description |
|----------|-------------|
|`createTasks`|Créations de tâches|
|`getTasks`|Récupérations de tâches|
|`searchTasks`|Recherches de tâches|
|`updateTasks`|Mises à jour de tâches|
|`deleteTasks`|Suppressions de tâches|
|`answerTasks`|Applications de réponses à des tâches|
|`assignTasks`|Assignations de tâches|

### OperationHandler

Les exécutions d'[OperationHandlers](broken-link.md) peuvent également être monitorées à l'aide de métriques : 

* `invokeSyncOperationHandler` pour ceux exécutés de manière synchrone
* `processAsyncOperationHandler` pour ceux exécutés de manière asynchrone

Ces métriques sont publiées avec les tags suivants : 

|Nom | Description |
|----------|-------------|
|`ObjectType`|Type d'objet concerné|
|`action`|Action à laquelle l'OperationHandler réagit|
|`phase`|Phase d'exécution|
|`registration`|Identifiant de l'[abonnement](broken-link.md)|
|`scope`|Identifiant du scope concerné|
|`exception`|Exception provoquée ou `none`|


*Une métrique est exposée à partir du moment où l'opération a été exécutée une première fois.*

### Autres 

Des dizaines d'autres métriques sont exposées comme les exports (ZIP ou CSV), les conversions, les authentifications...
Celles-ci peuvent évoluer en fonction des versions et peuvent être parcourues dans le système d'export utilisé (voir section ci-dessous).

## Métriques techniques

Les principales métriques techniques exposées par FlowerDocs Core sont listées ci-dessous.

|Nom | Description |
|----------|-------------|
|`process.cpu.usage`|Usage CPU du processus Java|
|`process.files.max`|Nombre maximum de fichiers pouvant être ouverts|
|`process.files.open`|Nombre de fichiers ouverts|
|`process.start.time`|Heure de démarrage du processus Java|
|`process.uptime`|Durée de fonctionnement du processus Java|
|`system.cpu.usage`|Usage CPU du système hôte|
|Nom | Description |
|----------|-------------|
|`jvm.buffer.count`||
|`jvm.buffer.memory.used`||
|`jvm.buffer.total.capacity`||
|`jvm.classes.loaded`||
|`jvm.classes.unloaded`||
|`jvm.gc.live.data.size`||
|`jvm.gc.max.data.size`||
|`jvm.gc.memory.allocated`||
|`jvm.gc.memory.promoted`||
|`jvm.gc.pause`||
|`jvm.memory.committed`||
|`jvm.memory.max`||
|`jvm.memory.used`||
|`jvm.threads.daemon`||
|`jvm.threads.live`||
|`jvm.threads.peak`||
|`jvm.threads.states`||
|Nom | Description |
|----------|-------------|
|`createDocuments`|Créations de documents|


# Consultation des métriques

## API REST

Les métriques sont exposées sur le endpoint `/actuator/metrics` et comme les autres endpoints [Actuator](broken-link.md).
Leur accès requiert une authentification *basic* d'un compte disposant du rôle `SYSTEM_ADMIN`.

GET /core/actuator/metrics HTTP/1.1
Authorization: Basic <basic authorization>
GET /core/actuator/metrics/getDocuments HTTP/1.1
Authorization: Basic <basic authorization>
GET /core/actuator/metrics/getDocuments?tag=scope:GEC HTTP/1.1
Authorization: Basic <basic authorization>


Ces web services peuvent être consommés depuis diverses applications de monitoring. Dans ce cas, l'utilisation d'un [compte utilisateur spécifique](broken-link.md) est recommandée.

## JMX

Les métriques sont exposées à travers des MBean JMX dans l'espace de nom `metrics`. Elles peuvent, par exemple, être consultées à l'aide d'outils fournis par un JDK comme `jconsole` ou `jvisualvm` (avec le plugin `VisualVM-MBeans`).
Les MBeans ne supportant pas la logique de tags, les noms des métriques publiées sont concaténés avec leurs tags.

<br/>
Par défaut, la technologie est accessible en local pour monitorer l'application et consulter les MBean.

Cette technologie peut également être utilisée à distance avec une configuration supplémentaire. Typiquement, en ajoutant les propriétés ci-dessous à la JVM, il est possible d'accéder de manière **non-sécurisée** depuis une machine distante aux MBeans.


```bash
-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=6001 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.rmi.port=6001 
```
:::info
Consulter la [documentation officielle](https://docs.oracle.com/en/java/javase/11/management/monitoring-and-management-using-jmx-technology.html) pour plus d'information.
:::